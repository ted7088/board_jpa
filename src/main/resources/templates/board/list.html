<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/layout}">
<div layout:fragment="content">

  <!-- 헤더 섹션 -->
  <div class="page-header mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h2 class="page-title mb-2">
          <i class="bi bi-list-ul me-2"></i>게시판
        </h2>
        <p class="page-subtitle mb-0">
          총 <span class="highlight" th:text="${totalItems}">0</span>개의 게시글
        </p>
      </div>
      <a href="/board/write" class="btn btn-primary btn-write">
        <i class="bi bi-pencil-square me-2"></i>글쓰기
      </a>
    </div>
  </div>

  <!-- 검색 및 정렬 -->
  <div class="search-sort-bar mb-3">
    <form class="search-form" method="get" th:action="@{/}">
      <div class="d-flex gap-2 align-items-center">
        <!-- 정렬 선택 -->
        <select class="form-select sort-select" id="sortBy" name="sortBy" onchange="this.form.submit()">
          <option value="latest" th:selected="${sortBy == 'latest' or sortBy == null}">최신순</option>
          <option value="likes" th:selected="${sortBy == 'likes'}">좋아요순</option>
          <option value="views" th:selected="${sortBy == 'views'}">조회수순</option>
        </select>

        <!-- 검색 -->
        <div class="input-group search-input">
          <input type="text" class="form-control" id="searchTitle" name="searchTitle" th:value="${searchTitle}"
            placeholder="제목 검색..." />
          <button type="submit" class="btn btn-outline-secondary">
            <i class="bi bi-search"></i>
          </button>
        </div>
      </div>
      <input type="hidden" name="page" value="0" />
    </form>
  </div>

  <!-- 게시글 테이블 -->
  <div class="board-table-container">
    <table class="table board-table">
      <thead>
        <tr>
          <th class="col-num">번호</th>
          <th class="col-title">제목</th>
          <th class="col-author">작성자</th>
          <th class="col-date">작성일</th>
          <th class="col-views">조회</th>
          <th class="col-likes">좋아요</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="board : ${boards}" class="board-row" th:onclick="'location.href=\'/board/' + ${board.id} + '\''">
          <td class="text-center">
            <span class="board-num" th:text="${board.id}">1</span>
          </td>
          <td class="title-cell">
            <a th:href="@{/board/{id}(id=${board.id})}" class="board-title-link" th:text="${board.title}">제목</a>
          </td>
          <td class="text-center author-cell">
            <span th:text="${board.author}">작성자</span>
          </td>
          <td class="text-center date-cell">
            <span th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd')}">2024-01-01</span>
          </td>
          <td class="text-center">
            <span class="stat-badge views-badge">
              <i class="bi bi-eye"></i>
              <span th:text="${board.viewCount}">0</span>
            </span>
          </td>
          <td class="text-center">
            <button class="stat-badge likes-badge" th:data-board-id="${board.id}"
              onclick="event.stopPropagation(); likePost(this);">
              <i class="bi bi-heart-fill"></i>
              <span class="like-count" th:text="${board.likeCount}">0</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- 페이징 -->
  <nav th:if="${totalPages > 0}" class="mt-4">
    <ul class="pagination justify-content-center">
      <!-- 이전 그룹 -->
      <li class="page-item" th:classappend="${!hasPrev} ? 'disabled'">
        <a class="page-link" th:href="@{/(page=${prevGroupStartPage}, sortBy=${sortBy}, searchTitle=${searchTitle})}"
          aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>

      <!-- 페이지 번호 -->
      <li class="page-item" th:each="pageNum : ${#numbers.sequence(startPage, endPage)}"
        th:classappend="${pageNum == currentPage} ? 'active'">
        <a class="page-link" th:href="@{/(page=${pageNum}, sortBy=${sortBy}, searchTitle=${searchTitle})}"
          th:text="${pageNum + 1}">1</a>
      </li>

      <!-- 다음 그룹 -->
      <li class="page-item" th:classappend="${!hasNext} ? 'disabled'">
        <a class="page-link" th:href="@{/(page=${nextGroupStartPage}, sortBy=${sortBy}, searchTitle=${searchTitle})}"
          aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    </ul>
  </nav>

  <!-- 좋아요 기능 JavaScript -->
  <script>
    function likePost(button) {
      const boardId = button.getAttribute('data-board-id');
      const likeCountSpan = button.querySelector('.like-count');

      fetch(`/api/boards/${boardId}/like`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      })
        .then(response => response.json())
        .then(data => {
          likeCountSpan.textContent = data.likeCount;
          button.classList.add('liked');
          setTimeout(() => {
            button.classList.remove('liked');
          }, 300);
        })
        .catch(error => {
          console.error('좋아요 처리 중 오류:', error);
        });
    }
  </script>

  <!-- 스타일 -->
  <style>
    .page-header {
      background: #fff;
      padding: 1.5rem;
      border-bottom: 2px solid #e9ecef;
      margin-bottom: 1.5rem;
    }

    .page-title {
      font-size: 1.75rem;
      font-weight: 600;
      color: #212529;
      margin: 0;
    }

    .page-subtitle {
      color: #6c757d;
      font-size: 0.95rem;
    }

    .highlight {
      color: #0d6efd;
      font-weight: 600;
    }

    .btn-write {
      padding: 0.5rem 1.5rem;
      font-weight: 500;
    }

    .search-sort-bar {
      background: #f8f9fa;
      padding: 1rem;
      border-radius: 0.375rem;
    }

    .sort-select {
      width: 140px;
      font-size: 0.9rem;
    }

    .search-input {
      flex: 1;
      max-width: 400px;
    }

    .search-input .form-control {
      font-size: 0.9rem;
    }

    .board-table-container {
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 0.375rem;
      overflow: hidden;
    }

    .board-table {
      margin: 0;
      font-size: 0.95rem;
    }

    .board-table thead {
      background: #f8f9fa;
      border-bottom: 2px solid #dee2e6;
    }

    .board-table thead th {
      font-weight: 600;
      color: #495057;
      padding: 1rem 0.75rem;
      border: none;
      text-align: center;
    }

    .board-table thead .col-num {
      width: 80px;
    }

    .board-table thead .col-title {
      text-align: left;
      padding-left: 1.5rem;
    }

    .board-table thead .col-author {
      width: 120px;
    }

    .board-table thead .col-date {
      width: 120px;
    }

    .board-table thead .col-views {
      width: 80px;
    }

    .board-table thead .col-likes {
      width: 80px;
    }

    .board-table tbody tr {
      border-bottom: 1px solid #e9ecef;
      transition: background-color 0.2s;
    }

    .board-table tbody tr:hover {
      background-color: #f8f9fa;
      cursor: pointer;
    }

    .board-table tbody td {
      padding: 1rem 0.75rem;
      vertical-align: middle;
    }

    .board-num {
      color: #6c757d;
      font-weight: 500;
    }

    .title-cell {
      padding-left: 1.5rem !important;
    }

    .board-title-link {
      color: #212529;
      text-decoration: none;
      font-weight: 500;
      display: block;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .board-title-link:hover {
      color: #0d6efd;
      text-decoration: underline;
    }

    .author-cell {
      color: #6c757d;
    }

    .date-cell {
      color: #6c757d;
      font-size: 0.9rem;
    }

    .stat-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.85rem;
      border: none;
      background: none;
      cursor: default;
    }

    .views-badge {
      color: #6c757d;
    }

    .likes-badge {
      color: #dc3545;
      cursor: pointer;
      transition: all 0.2s;
    }

    .likes-badge:hover {
      background-color: #ffe5e5;
      transform: scale(1.05);
    }

    .likes-badge.liked {
      animation: heartBeat 0.3s ease;
    }

    @keyframes heartBeat {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.2);
      }
    }

    .stat-badge i {
      font-size: 0.9rem;
    }

    /* 페이징 스타일 */
    .pagination {
      margin: 0;
    }

    .pagination .page-link {
      color: #495057;
      border-color: #dee2e6;
    }

    .pagination .page-item.active .page-link {
      background-color: #0d6efd;
      border-color: #0d6efd;
    }

    .pagination .page-link:hover {
      color: #0d6efd;
    }

    /* 반응형 */
    @media (max-width: 768px) {
      .search-sort-bar .d-flex {
        flex-direction: column;
      }

      .sort-select {
        width: 100%;
      }

      .search-input {
        max-width: 100%;
      }

      .board-table {
        font-size: 0.85rem;
      }

      .board-table thead .col-num,
      .board-table thead .col-views,
      .board-table thead .col-likes {
        display: none;
      }

      .board-table tbody td:nth-child(1),
      .board-table tbody td:nth-child(5),
      .board-table tbody td:nth-child(6) {
        display: none;
      }

      .board-table thead .col-date {
        width: 100px;
      }

      .title-cell {
        padding-left: 1rem !important;
      }
    }
  </style>
</div>

</html>